<!DOCTYPE html>
{% set title = "Constra - Building Construction Website Template" %}
{% extends "templates/web.html" %}
import frappe

{% block head %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<meta charset="utf-8">
<title>Constra - Building Construction Website Template</title>
<meta content="width=device-width, initial-scale=1.0" name="viewport">
<meta content="" name="keywords">
<meta content="" name="description">
<!-- Google Web Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link
    href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400..900;1,400..900&family=Roboto:wght@400;500;700&display=swap"
    rel="stylesheet">
<!-- Icon Font Stylesheet -->
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css" />
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">
<!-- Libraries Stylesheet -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
<link href="lib/animate/animate.min.css" rel="stylesheet">
<link href="lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">
<link href="lib/lightbox/css/lightbox.min.css" rel="stylesheet">
<!-- Customized Bootstrap Stylesheet -->
<link href="css/bootstrap.min.css" rel="stylesheet">
<link href="css/style.css" rel="stylesheet">
{% endblock %}

{% block navbar %}
<div class="container-fluid topbar d-none d-xl-block w-100">
    <div class="row gx-0 align-items-center" style="height: 45px;">
        <div class="col-lg-6 text-center text-lg-start mb-lg-0">
            <div class="d-flex flex-wrap">
                <a href="#" class="text-muted me-4"><i class="fas fa-map-marker-alt text-secondary me-2"></i>Find A
                    Location</a>
                <a href="#" class="text-muted me-4"><i class="fas fa-phone-alt text-secondary me-2"></i>+01234567890</a>
                <a href="#" class="text-muted me-0"><i
                        class="fas fa-envelope text-secondary me-2"></i>Example@gmail.com</a>
            </div>
        </div>
        <div class="col-lg-6 text-center text-lg-end">
            <div class="d-flex align-items-center justify-content-end">
                <a href="#" class="text-muted me-3"><i class="fas fa-clock text-secondary me-2"></i>Mon - Sat 8:00 -
                    17:30, Sunday - CLOSED</a>
                <a href="#" class="btn btn-primary btn-square border border-white me-3"><i
                        class="fab fa-facebook-f"></i></a>
                <a href="#" class="btn btn-primary btn-square border border-white me-3"><i
                        class="fab fa-twitter"></i></a>
                <a href="#" class="btn btn-primary btn-square border border-white me-3"><i
                        class="fab fa-instagram"></i></a>
                <a href="#" class="btn btn-primary btn-square border border-white me-3"><i
                        class="fab fa-linkedin-in"></i></a>
            </div>
        </div>
    </div>
</div>
<!-- Topbar End -->


<!-- Navbar & Hero Start -->
<div class="container-fluid sticky-top px-0">
    <nav class="navbar navbar-expand-lg navbar-dark bg-light py-3 px-4">
        <a href="index.html" class="navbar-brand p-0">
            <h1 class="text-secondary display-6"><i class="fas fa-city text-primary me-3"></i>Constra</h1>
            <!-- <img src="img/logo.png" alt="Logo"> -->
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse">
            <span class="fa fa-bars"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarCollapse">
            <div class="navbar-nav ms-auto pt-2 pt-lg-0">
                <a href="index.html" class="nav-item nav-link active">Home</a>
                <a href="about.html" class="nav-item nav-link">About</a>
                <a href="service.html" class="nav-item nav-link">Services</a>
                <a href="projectes.html" class="nav-item nav-link">Projects</a>
                <div class="nav-item dropdown">
                    <a href="#" class="nav-link dropdown-toggle text-dark" data-bs-toggle="dropdown">Pages</a>
                    <div class="dropdown-menu m-lg-0">
                        <a href="feature.html" class="dropdown-item">Our Features</a>
                        <a href="blog.html" class="dropdown-item">Our Blog</a>
                        <a href="team.html" class="dropdown-item">Our Team</a>
                        <a href="testimonial.html" class="dropdown-item">Testimonial</a>
                        <a href="404.html" class="dropdown-item">404 Page</a>
                        <a href="events.html" class="dropdown-item">Event</a>
                    </div>
                </div>
                <a href="contact.html" class="nav-item nav-link">Contact</a>
                <a href="login.html" class="nav-item nav-link">Login</a>
            </div>
            <div class="d-flex align-items-center flex-nowrap pt-3  pt-lg-0 ms-lg-2">
                <button class="btn btn-primary py-2 px-3" data-bs-toggle="modal" data-bs-target="#searchModal"><i
                        class="fas fa-search"></i></button>
                <a href="#" class="btn btn-secondary py-2 px-4 ms-3 flex-wrap flex-sm-shrink-0">Get a Quate</a>
            </div>
        </div>
    </nav>
</div>
{% endblock %}


{% block page_content %}



<div class="container" style="display: flex; justify-content: center; align-items: center; min-height: 70vh;">
    <div
        style="background-color: #ffffff; padding: 30px; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); width: 100%; max-width: 400px;">
        <img src="/files/64-Network-PNG-Logo3.png"
            style="display: block; margin: 0 auto; width: 40px; height: 40px; object-fit: fill; border-radius: 50%;">
        <p style="text-align: center;font-weight:bold;font-size:18px;">64Network security Pvt Ltd</p>
        <form onsubmit="event.preventDefault(); checkCredentials();">
            <div style="margin-bottom: 15px;position: relative;">
                <i class="fa fa-user"
                    style="position: absolute; top: 50%; left: 10px; transform: translateY(-50%); color: #888;"></i>
                <input type="text" id="email" placeholder="Email or Username" autocomplete="username" required
                    style="width: 100%; padding: 5px 5px 5px 30px; border-radius: 5px; border: 1px solid #ccc;" />
            </div>
            <div style="margin-bottom: 15px; position: relative;">
                <i class="fa fa-lock"
                    style="position: absolute; top: 50%; left: 10px; transform: translateY(-50%); color: #888;"></i>
                <input type="password" id="password" placeholder="Password" autocomplete="current-password" required
                    style="width: 100%; padding: 5px 35px 5px 30px; border-radius: 5px; border: 1px solid #ccc;" />
                <i class="fa fa-eye" id="togglePassword"
                    style="position: absolute; top: 50%; right: 10px; transform: translateY(-50%); cursor: pointer; color: #888;"></i>
            </div>

            <button type="submit"
                style="width: 100%; padding: 5px; background-color: #FF5E15; color:white !important; border: none; border-radius: 5px;">Login</button>
        </form>

        <div id="otp-box" style="display:none; margin-top: 20px;">
            <input type="text" id="otp" placeholder="Enter OTP"
                style="width: 100%; padding: 5px; margin-bottom: 10px; border-radius: 5px; border: 1px solid #ccc;" />
            <button id="verify-btn"
                style="width: 100%; padding: 5px; background-color: #28a745; color: white !important; border: none; border-radius: 5px;">Verify
                OTP</button>
        </div>
        <button id="reset-totp-btn" class="hidden"
            style="margin-top: 10px; background-color: #dc3545; color: white !important; padding: 5px; border: none; border-radius: 5px; display: none;">
            Reset Authenticator Setup
        </button>
    </div>
    <div id="qr-instruction" style="display: none; margin-top: 10px; text-align: center;">
        <p>Scan this QR code in Google Authenticator or any TOTP app:</p>
        <div id="qrcode" style="margin: auto;"></div>
    </div>
</div>

{% endblock %}

{% block footer %}
<div class="container-fluid footer py-5 wow fadeIn" data-wow-delay="0.2s">
    <div class="container py-5">
        <div class="row g-5">
            <div class="col-md-6 col-lg-6 col-xl-3">
                <div class="footer-item d-flex flex-column">
                    <div class="footer-item">
                        <h4 class="text-white mb-4">Newsletter</h4>
                        <p class="mb-3">Dolor amet sit justo amet elitr clita ipsum elitr est.Lorem ipsum dolor sit
                            amet, consectetur adipiscing elit consectetur adipiscing elit.</p>
                        <div class="position-relative mx-auto">
                            <input class="form-control w-100 py-3 ps-4 pe-5" type="text" placeholder="Enter your email">
                            <button type="button"
                                class="btn btn-secondary position-absolute top-0 end-0 py-2 mt-2 me-2">SignUp</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6 col-lg-6 col-xl-3">
                <div class="footer-item d-flex flex-column">
                    <h4 class="text-white mb-4">Explore</h4>
                    <a href="#"><i class="fas fa-angle-right me-2"></i> Home</a>
                    <a href="#"><i class="fas fa-angle-right me-2"></i> Services</a>
                    <a href="#"><i class="fas fa-angle-right me-2"></i> About Us</a>
                    <a href="#"><i class="fas fa-angle-right me-2"></i> Latest Projects</a>
                    <a href="#"><i class="fas fa-angle-right me-2"></i> testimonial</a>
                    <a href="#"><i class="fas fa-angle-right me-2"></i> Our Team</a>
                    <a href="#"><i class="fas fa-angle-right me-2"></i> Contact Us</a>
                </div>
            </div>
            <div class="col-md-6 col-lg-6 col-xl-3">
                <div class="footer-item d-flex flex-column">
                    <h4 class="text-white mb-4">Our Services</h4>
                    <a href="#"><i class="fas fa-angle-right me-2"></i> General Construction</a>
                    <a href="#"><i class="fas fa-angle-right me-2"></i> Property Maintenance</a>
                    <a href="#"><i class="fas fa-angle-right me-2"></i> Project Managment</a>
                    <a href="#"><i class="fas fa-angle-right me-2"></i> Virtual Design &amp; Build</a>
                    <a href="#"><i class="fas fa-angle-right me-2"></i> Residential Construction</a>
                    <a href="#"><i class="fas fa-angle-right me-2"></i> Preconstruction</a>
                    <a href="#"><i class="fas fa-angle-right me-2"></i> Design Build</a>
                </div>
            </div>
            <div class="col-md-6 col-lg-6 col-xl-3">
                <div class="footer-item d-flex flex-column">
                    <h4 class="text-white mb-4">Contact Info</h4>
                    <a href=""><i class="fa fa-map-marker-alt me-2"></i> 123 Street, New York, USA</a>
                    <a href=""><i class="fas fa-envelope me-2"></i> info@example.com</a>
                    <a href=""><i class="fas fa-envelope me-2"></i> info@example.com</a>
                    <a href=""><i class="fas fa-phone me-2"></i> +012 345 67890</a>
                    <a href="" class="mb-3"><i class="fas fa-print me-2"></i> +012 345 67890</a>
                    <div class="footer-btn d-flex align-items-center">
                        <a class="btn btn-secondary btn-md-square me-2" href=""><i
                                class="fab fa-facebook-f text-white"></i></a>
                        <a class="btn btn-secondary btn-md-square me-2" href=""><i
                                class="fab fa-twitter text-white"></i></a>
                        <a class="btn btn-secondary btn-md-square me-2" href=""><i
                                class="fab fa-instagram text-white"></i></a>
                        <a class="btn btn-secondary btn-md-square me-0" href=""><i
                                class="fab fa-linkedin-in text-white"></i></a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}


{% block script %}

<script>
    document.addEventListener("DOMContentLoaded", function () {
        let userEmail = "";
        let userPassword = "";

        window.checkCredentials = function () {
            const userEmail = document.getElementById("email").value;
            const userPassword = document.getElementById("password").value;

            if (!userEmail || !userPassword) {
                frappe.msgprint("Please enter email and password.");
                return;
            }

            frappe.call({
                method: "custom_renewal.api.validate_credentials_and_send_otp_or_login",
                args: {
                    email: userEmail,
                    password: userPassword
                },
                callback: function (r) {
                    if (r.message && r.message.otp_required) {
                        document.getElementById("otp-box").style.display = "block";

                        if (r.message.otp_method === "email") {
                            frappe.msgprint("OTP sent to your email.");
                        } else if (r.message.otp_method === "app") {
                            document.getElementById("reset-totp-btn").style.display = "block";
                            // Show QR if provided
                            if (r.message.otp_auth_url) {
                                document.getElementById("qr-instruction").style.display = "block";
                                // Clear old QR if needed
                                document.getElementById("qrcode").innerHTML = "";
                                new QRCode(document.getElementById("qrcode"), r.message.otp_auth_url);
                            } else {
                                frappe.msgprint("Enter the OTP from your Authenticator App.");
                            }
                        }

                    } else if (r.message) {
                        frappe.msgprint("Login successful. Redirecting...");
                        setTimeout(() => {
                            window.location.href = "/app";
                        }, 1000);
                    }
                },
                error: function (r) {
                    const msg = (r.message || (r.responseJSON && r.responseJSON._error_message)) || "Login failed.";
                    frappe.msgprint(msg);
                }
            });
        };


        document.getElementById("verify-btn").addEventListener("click", function () {
            const otp = document.getElementById("otp").value;
            const email = document.getElementById("email").value;

            frappe.call({
                method: "custom_renewal.api.verify_otp_and_login",
                args: {
                    email: email,
                    input_otp: otp
                },
                callback: function (r) {
                    if (!r.exc) {
                        frappe.msgprint("Login successful. Redirecting...");
                        setTimeout(() => {
                            const userType = r.message.user_type;
                            if (userType === "Website User") {
                                window.location.href = "/me";
                            } else {
                                window.location.href = "/app";
                            }
                        }, 1000);
                    }
                },
                error: function () {
                    frappe.msgprint("Invalid OTP.");
                }
            });
        });
    });

    document.getElementById("reset-totp-btn").addEventListener("click", function () {
        const email = document.getElementById("email").value;
        frappe.call({
            method: "custom_renewal.api.reset_user_totp",
            args: {
                email: email
            },
            callback: function (r) {
                if (r.message && r.message.otp_auth_url) {
                    document.getElementById("qr-instruction").style.display = "block";
                    document.getElementById("qrcode").innerHTML = "";
                    new QRCode(document.getElementById("qrcode"), r.message.otp_auth_url);
                    frappe.msgprint("New QR code generated. Please scan it again.");
                }
            },
            error: function () {
                frappe.msgprint("Failed to reset TOTP.");
            }
        });
    });
</script>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const passwordInput = document.getElementById("password");
        const togglePassword = document.getElementById("togglePassword");

        togglePassword.addEventListener("click", function () {
            const type = passwordInput.getAttribute("type") === "password" ? "text" : "password";
            passwordInput.setAttribute("type", type);
            this.classList.toggle("fa-eye");
            this.classList.toggle("fa-eye-slash");
        });
    });
</script>

<script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="lib/wow/wow.min.js"></script>
<script src="lib/easing/easing.min.js"></script>
<script src="lib/waypoints/waypoints.min.js"></script>
<script src="lib/counterup/counterup.min.js"></script>
<script src="lib/owlcarousel/owl.carousel.min.js"></script>
<script src="lib/lightbox/js/lightbox.min.js"></script>


<!-- Template Javascript -->
<script src="js/main.js"></script>


{%endblock %}
{% block style %}
<style>
    body {
        background-color: #f0f0f0 !important;
    }

    /*.page-content-wrapper {
        background-color: #f0f0f0 !important;
    }*/

    /*.web-footer {
        display: none !important;
        background-color: #f0f0f0 !important;
    }*/
</style>
{% endblock %}